<!DOCTYPE html>
<html lang="en" class="w-full h-full">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulation couverture satellitaire</title>
    <link href="index.css" rel="stylesheet"/> 
</head>

<body class="w-full h-full relative">
    <div class="absolute h-full w-96 flex items-center right-12">
        <div class="flex flex-col gap-2 justify-center w-96 h-2/3 bg-gray-100 rounded-xl p-8">
            <label for="N_satellites">Nombre de satellites :</label>
            <input type="number" id="N_satellites"
                class="text-sm rounded-lg block w-full p-2.5 bg-gray-200 border-gray-600" />
            <div class="flex justify-center gap-2 items-center">
                <div class="flex items-center flex-col">
                    <label for="lat">Latitude</label>
                    <input type="number" id="lat"
                        class="text-sm rounded-lg block w-full p-2.5 bg-gray-200 border-gray-600" />
                </div>
                <div class="flex items-center flex-col">
                    <label for="long">Longitude</label>
                    <input type="number" id="long"
                        class="text-sm rounded-lg block w-full p-2.5 bg-gray-200 border-gray-600" />
                </div>
                <div class="flex items-center flex-col">
                    <label for="x">Poids</label>
                    <input type="number" id="w"
                        class="text-sm rounded-lg block w-full p-2.5 bg-gray-200 border-gray-600" />
                </div>
            </div>
            <button class="border-2 h-min border-gray-200 p-2 rounded-xl" onclick="add_city()">Ajouter une ville</button>
            <div class="flex">
                <button class="rounded-l-xl border-gray-200 border-2 border-r-0 p-2 w-full" onclick="add_random_cities()">Ajouter</button>
                <input type="number" id="n_random_cities" class="text-sm block p-2.5 bg-inherit border-2 border-gray-200 w-16" />
                <button class="rounded-r-xl border-gray-200 border-2 border-l-0 p-2 w-full" onclick="add_random_cities()"> villes al√©atoires</button>
            </div>
            <div id="cities" class="flex flex-col max-h-48 overflow-scroll"></div>
            <button class="border-2 h-min border-gray-200 p-2 rounded-xl" onClick="clear_cities()">Supprimer les villes</button>
    
            <button class="border-2 h-min border-gray-200 p-2 rounded-xl" onClick="compute()">Calculer</button>
        </div>    
    </div>
    <iframe id="content" class="h-full w-full"></iframe>

    <script>

        cities = []
        weights = []
        N_satellites_input = document.getElementById('N_satellites')
        function compute() {

            console.log("Computing");
            fetch("http://127.0.0.1:5000/compute", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    N_satellites: N_satellites_input.value,
                    cities_coordinates: cities,
                    cities_weights: weights,
                    format: "spherical",
                    R: 6371,
                    H: 35786,
                    P: 100e3,
                    I_necessary: (10 ** ((-67 - 30) / 10)) * 1e4,
                    alpha: Math.PI,
                    verbose: true
                })
            })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('content').src = data['content'];
                    console.log(data['content']);
                })
                .finally(() => {
                    console.log("Done");
                });
        }
        lat_input = document.getElementById('lat')
        long_input = document.getElementById('long')
        w_input = document.getElementById('w')
        cities_div = document.getElementById('cities')
        function add_city() {
            console.log(cities)
            cities.push([lat_input.value, long_input.value])
            weights.push(w_input.value)
            console.log("Adding w:" + w_input.value  + " ,lat:" + lat_input.value + ", long:" + long_input.value)
            update_cities()
        }

        function delete_city(index) {
            cities.splice(index, 1)
            update_cities()
        }

        n_random_cities_input = document.getElementById("n_random_cities")
        min_long = -180
        max_long = 180
        min_lat = -90
        max_lat = 90

        function add_random_cities() {
            for (i = 0; i < n_random_cities_input.value; i++) {
                long = Math.random()*(max_long - min_long) + min_long
                lat = Math.random()*(max_lat - min_lat) + min_lat
                w = Math.random()*10 + 10
                cities.push([long, lat])
                weights.push(w)
            }
            update_cities()
        }

        function update_cities() {
            cities_div.innerHTML = ""
            for (i = 0; i < cities.length; i++) {
                cities_div.innerHTML += `
                <div class="flex justify-between w-full px-2">
                    <div class="flex gap-2 w-11/12">
                        <p>Long: ${cities[i][0]}</p>
                        <p>lat: ${cities[i][1]}</p>
                        <p>W: ${weights[i]}</p>
                    </div>
                    <img src="close.svg" onClick="delete_city(${i})" class="self-end w-1/12 text-gray-200">
                </div>
                `
            }
        }

        function clear_cities() {
            cities = []
            weights = []
            update_cities()
        }
    </script>
</body>

</html>